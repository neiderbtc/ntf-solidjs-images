const e={};function t(t){e.context=t}const r={equals:(e,t)=>e===t};let n=k;const o={},i={owned:null,cleanups:null,context:null,owner:null};var s=null;let a=null,c=null,u=null,f=null,l=0;function h(e,t){t=t?Object.assign({},r,t):r;const n={value:e,observers:null,observerSlots:null,pending:o,comparator:t.equals||void 0};return[y.bind(n),e=>("function"==typeof e&&(e=e(n.pending!==o?n.pending:n.value)),g(n,e))]}function d(e,t,r){b(m(e,t,!1,1))}function p(e,t,r){n=A;const o=m(e,t,!1,1),i=undefined;o.user=!0,f&&f.push(o)}function w(e){let t,r=a;return a=null,t=e(),a=r,t}function y(){if(this.state&&this.sources){const e=u;u=null,1===this.state?b(this):T(this),u=e}if(a){const e=this.observers?this.observers.length:0;a.sources?(a.sources.push(this),a.sourceSlots.push(e)):(a.sources=[this],a.sourceSlots=[e]),this.observers?(this.observers.push(a),this.observerSlots.push(a.sources.length-1)):(this.observers=[a],this.observerSlots=[a.sources.length-1])}return this.value}function g(e,t,r){if(e.comparator&&e.comparator(e.value,t))return t;if(c)return e.pending===o&&c.push(e),e.pending=t,t;let n=!1;return e.value=t,e.observers&&e.observers.length&&E((()=>{for(let t=0;t<e.observers.length;t+=1){const r=e.observers[t];n,r.pure?u.push(r):f.push(r),r.observers&&!r.state&&C(r),r.state=1}if(u.length>1e6)throw u=[],new Error}),!1),t}function b(e){if(!e.fn)return;B(e);const t=s,r=a,n=l;a=s=e,function(e,t,r){let n;try{n=e.fn(t)}catch(o){x(o)}(!e.updatedAt||e.updatedAt<=r)&&(e.observers&&e.observers.length?g(e,n):e.value=n,e.updatedAt=r)}(e,e.value,n),a=r,s=t}function m(e,t,r,n=1,o){const a={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:s,context:null,pure:r};return null===s||s!==i&&(s.owned?s.owned.push(a):s.owned=[a]),a}function v(e){if(1!==e.state)return e.state=0;if(e.suspense&&w(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<l);)e.state&&t.push(e);for(let r=t.length-1;r>=0;r--)if(1===(e=t[r]).state)b(e);else if(2===e.state){const t=u;u=null,T(e),u=t}}function E(e,t){if(u)return e();let r=!1;t||(u=[]),f?r=!0:f=[],l++;try{e()}catch(i){x(i)}finally{!function(e){u&&(k(u),u=null);if(e)return;f.length?function(e){if(c)return e();let t;const r=c=[];try{t=e()}finally{c=null}E((()=>{for(let e=0;e<r.length;e+=1){const t=r[e];if(t.pending!==o){const e=t.pending;t.pending=o,g(t,e)}}}),!1)}((()=>{n(f),f=null})):f=null}(r)}}function k(e){for(let t=0;t<e.length;t++)v(e[t])}function A(e){let t,r=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[r++]=n:v(n)}const n=e.length;for(t=0;t<r;t++)v(e[t]);for(t=n;t<e.length;t++)v(e[t])}function T(e){e.state=0;for(let t=0;t<e.sources.length;t+=1){const r=e.sources[t];r.sources&&(1===r.state?v(r):2===r.state&&T(r))}}function C(e){for(let t=0;t<e.observers.length;t+=1){const r=e.observers[t];r.state||(r.state=2,r.pure?u.push(r):f.push(r),r.observers&&C(r))}}function B(e){let t;if(e.sources)for(;e.sources.length;){const t=e.sources.pop(),r=e.sourceSlots.pop(),n=t.observers;if(n&&n.length){const e=n.pop(),o=t.observerSlots.pop();r<n.length&&(e.sourceSlots[o]=r,n[r]=e,t.observerSlots[r]=o)}}if(e.owned){for(t=0;t<e.owned.length;t++)B(e.owned[t]);e.owned=null}if(e.cleanups){for(t=0;t<e.cleanups.length;t++)e.cleanups[t]();e.cleanups=null}e.state=0,e.context=null}function x(e){throw e}function I(r,n){if(e.context){const o=e.context;t({...e.context,id:`${e.context.id}${e.context.count++}.`,count:0});const i=w((()=>r(n)));return t(o),i}return w((()=>r(n)))}function _(e,t,r){let n=r.length,o=t.length,i=n,s=0,a=0,c=t[o-1].nextSibling,u=null;for(;s<o||a<i;)if(t[s]!==r[a]){for(;t[o-1]===r[i-1];)o--,i--;if(o===s){const t=i<n?a?r[a-1].nextSibling:r[i-a]:c;for(;a<i;)e.insertBefore(r[a++],t)}else if(i===a)for(;s<o;)u&&u.has(t[s])||e.removeChild(t[s]),s++;else if(t[s]===r[i-1]&&r[a]===t[o-1]){const n=t[--o].nextSibling;e.insertBefore(r[a++],t[s++].nextSibling),e.insertBefore(r[--i],n),t[o]=r[i]}else{if(!u){u=new Map;let e=a;for(;e<i;)u.set(r[e],e++)}const n=u.get(t[s]);if(null!=n)if(a<n&&n<i){let c,f=s,l=1;for(;++f<o&&f<i&&null!=(c=u.get(t[f]))&&c===n+l;)l++;if(l>n-a){const o=t[s];for(;a<n;)e.insertBefore(r[a++],o)}else e.replaceChild(r[a++],t[s++])}else s++;else e.removeChild(t[s++])}}else s++,a++}function D(e,t,r){let n;return function(e,t){t&&(s=t);const r=a,n=s,o=0===e.length?i:{owned:null,cleanups:null,context:null,owner:n};let c;s=o,a=null;try{E((()=>c=e((()=>B(o)))),!0)}finally{a=r,s=n}}((o=>{n=o,j(t,e(),t.firstChild?null:void 0,r)})),()=>{n(),t.textContent=""}}function S(e,t,r){const n=document.createElement("template");n.innerHTML=e;let o=n.content.firstChild;return r&&(o=o.firstChild),o}function N(e,t=window.document){const r=t._$DX_DELEGATE||(t._$DX_DELEGATE=new Set);for(let n=0,o=e.length;n<o;n++){const o=e[n];r.has(o)||(r.add(o),t.addEventListener(o,O))}}function U(e,t,r){null==r?e.removeAttribute(t):e.setAttribute(t,r)}function R(e,t,r,n){n?Array.isArray(r)?(e[`$$${t}`]=r[0],e[`$$${t}Data`]=r[1]):e[`$$${t}`]=r:Array.isArray(r)?e.addEventListener(t,(e=>r[0](r[1],e))):e.addEventListener(t,r)}function j(e,t,r,n){if(void 0===r||n||(n=[]),"function"!=typeof t)return L(e,t,n,r);d((n=>L(e,t(),n,r)),n)}function O(e){const t=`$$${e.type}`;let r=e.composedPath&&e.composedPath()[0]||e.target;for(e.target!==r&&Object.defineProperty(e,"target",{configurable:!0,value:r}),Object.defineProperty(e,"currentTarget",{configurable:!0,get:()=>r});null!==r;){const n=r[t];if(n&&!r.disabled){const o=r[`${t}Data`];if(void 0!==o?n(o,e):n(e),e.cancelBubble)return}r=r.host&&r.host!==r&&r.host instanceof Node?r.host:r.parentNode}}function L(t,r,n,o,i){for(;"function"==typeof n;)n=n();if(r===n)return n;const s=typeof r,a=void 0!==o;if(t=a&&n[0]&&n[0].parentNode||t,"string"===s||"number"===s)if("number"===s&&(r=r.toString()),a){let e=n[0];e&&3===e.nodeType?e.data=r:e=document.createTextNode(r),n=P(t,n,o,e)}else n=""!==n&&"string"==typeof n?t.firstChild.data=r:t.textContent=r;else if(null==r||"boolean"===s){if(e.context)return n;n=P(t,n,o)}else{if("function"===s)return d((()=>{let e=r();for(;"function"==typeof e;)e=e();n=L(t,e,n,o)})),()=>n;if(Array.isArray(r)){const s=[];if(z(s,r,i))return d((()=>n=L(t,s,n,o,!0))),()=>n;if(e.context&&n&&n.length)return n;if(0===s.length){if(n=P(t,n,o),a)return n}else Array.isArray(n)?0===n.length?$(t,s,o):_(t,n,s):null==n||""===n?$(t,s):_(t,a&&n||[t.firstChild],s);n=s}else if(r instanceof Node){if(Array.isArray(n)){if(a)return n=P(t,n,o,r);P(t,n,null,r)}else null!=n&&""!==n&&t.firstChild?t.replaceChild(r,t.firstChild):t.appendChild(r);n=r}}return n}function z(e,t,r){let n=!1;for(let o=0,i=t.length;o<i;o++){let i,s=t[o];if(s instanceof Node)e.push(s);else if(null==s||!0===s||!1===s);else if(Array.isArray(s))n=z(e,s)||n;else if("string"==(i=typeof s))e.push(document.createTextNode(s));else if("function"===i)if(r){for(;"function"==typeof s;)s=s();n=z(e,Array.isArray(s)?s:[s])||n}else e.push(s),n=!0;else e.push(document.createTextNode(s.toString()))}return n}function $(e,t,r){for(let n=0,o=t.length;n<o;n++)e.insertBefore(t[n],r)}function P(e,t,r,n){if(void 0===r)return e.textContent="";const o=n||document.createTextNode("");if(t.length){let n=!1;for(let i=t.length-1;i>=0;i--){const s=t[i];if(o!==s){const t=s.parentNode===e;n||i?t&&e.removeChild(s):t?e.replaceChild(o,s):e.insertBefore(o,r)}else n=!0}}else e.insertBefore(o,r);return[o]}function M(e,t,r){const n=function(e){if("function"==typeof e.next)return e;if("function"==typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"==typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}(r),o=[],i=[];let s=!1,a=!1,c=0,u=null;function f(){for(;i.length>0&&o.length>0;){const{resolve:e}=i.shift();e({done:!1,value:o.shift()})}for(;i.length>0&&0===c&&s;){const{resolve:e,reject:t}=i.shift();u?(t(u),u=null):e({done:!0,value:void 0})}}async function l(){if(s)f();else if(!(a||c+o.length>=e)){a=!0,c++;try{const{done:e,value:r}=await n.next();e?(s=!0,c--,f()):async function(e){try{const r=await t(e);o.push(r)}catch(r){s=!0,u=r}c--,f(),l()}(r)}catch(r){s=!0,c--,u=r,f()}a=!1,l()}}const h={next:async function(){if(0===o.length){const e=function(){let e,t;return{promise:new Promise(((r,n)=>{t=r,e=n})),reject:e,resolve:t}}();return i.push(e),l(),e.promise}const e=o.shift();return l(),{done:!1,value:e}},[Symbol.asyncIterator]:()=>h};return h}function H(e,t,r){return void 0===t?(t,r)=>r?H(e,t,r):H(e,t):void 0===r?r=>H(e,t,r):M(e,t,r)}var F={exports:{}},G={};function V(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var q,J,W=V;V.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},V.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},V.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var n=this;return this._timer=setTimeout((function(){n._attempts++,n._operationTimeoutCb&&(n._timeout=setTimeout((function(){n._operationTimeoutCb(n._attempts)}),n._operationTimeout),n._options.unref&&n._timeout.unref()),n._fn(n._attempts)}),r),this._options.unref&&this._timer.unref(),!0},V.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){r._operationTimeoutCb()}),r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},V.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},V.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},V.prototype.start=V.prototype.try,V.prototype.errors=function(){return this._errors},V.prototype.attempts=function(){return this._attempts},V.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var o=this._errors[n],i=o.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=o,r=s)}return t},J=W,(q=G).operation=function(e){var t=q.timeouts(e);return new J(t,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},q.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],o=0;o<t.retries;o++)n.push(this.createTimeout(o,t));return e&&e.forever&&!n.length&&n.push(this.createTimeout(o,t)),n.sort((function(e,t){return e-t})),n},q.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,n=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return n=Math.min(n,t.maxTimeout)},q.wrap=function(e,t,r){if(t instanceof Array&&(r=t,t=null),!r)for(var n in r=[],e)"function"==typeof e[n]&&r.push(n);for(var o=0;o<r.length;o++){var i=r[o],s=e[i];e[i]=function(r){var n=q.operation(t),o=Array.prototype.slice.call(arguments,1),i=o.pop();o.push((function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),i.apply(this,arguments))})),n.attempt((function(){r.apply(e,o)}))}.bind(e,s),e[i].options=t}};const X=G,K=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class Q extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,({message:e}=e)):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Y=(e,t)=>new Promise(((r,n)=>{t={onFailedAttempt:()=>{},retries:10,...t};const o=X.operation(t);o.attempt((async i=>{try{r(await e(i))}catch(a){if(!(a instanceof Error))return void n(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));if(a instanceof Q)o.stop(),n(a.originalError);else if(a instanceof TypeError&&(s=a.message,!K.includes(s)))o.stop(),n(a);else{((e,t,r)=>{const n=r.retries-(t-1);e.attemptNumber=t,e.retriesLeft=n})(a,i,t);try{await t.onFailedAttempt(a)}catch(c){return void n(c)}o.retry(a)||n(o.mainError())}}var s}))}));F.exports=Y,F.exports.default=Y,F.exports.AbortError=Q;var Z=F.exports,ee=function e(t,r,n){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");r=r||[];var o=n=n||0;for(;t>=te;)r[n++]=255&t|128,t/=128;for(;-128&t;)r[n++]=255&t|128,t>>>=7;return r[n]=0|t,e.bytes=n-o+1,r},te=Math.pow(2,31);var re=function e(t,r){var n,o=0,i=0,s=r=r||0,a=t.length;do{if(s>=a||i>49)throw e.bytes=0,new RangeError("Could not decode varint");n=t[s++],o+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=s-r,o};var ne=Math.pow(2,7),oe=Math.pow(2,14),ie=Math.pow(2,21),se=Math.pow(2,28),ae=Math.pow(2,35),ce=Math.pow(2,42),ue=Math.pow(2,49),fe=Math.pow(2,56),le=Math.pow(2,63),he={encode:ee,decode:re,encodingLength:function(e){return e<ne?1:e<oe?2:e<ie?3:e<se?4:e<ae?5:e<ce?6:e<ue?7:e<fe?8:e<le?9:10}},de=function e(t,r,n){r=r||[];var o=n=n||0;for(;t>=pe;)r[n++]=255&t|128,t/=128;for(;-128&t;)r[n++]=255&t|128,t>>>=7;return r[n]=0|t,e.bytes=n-o+1,r},pe=Math.pow(2,31);var we=function e(t,r){var n,o=0,i=0,s=r=r||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");n=t[s++],o+=i<28?(127&n)<<i:(127&n)*Math.pow(2,i),i+=7}while(n>=128);return e.bytes=s-r,o};var ye=Math.pow(2,7),ge=Math.pow(2,14),be=Math.pow(2,21),me=Math.pow(2,28),ve=Math.pow(2,35),Ee=Math.pow(2,42),ke=Math.pow(2,49),Ae=Math.pow(2,56),Te=Math.pow(2,63),Ce={encode:de,decode:we,encodingLength:function(e){return e<ye?1:e<ge?2:e<be?3:e<me?4:e<ve?5:e<Ee?6:e<ke?7:e<Ae?8:e<Te?9:10}};const Be=e=>[Ce.decode(e),Ce.decode.bytes],xe=(e,t,r=0)=>(Ce.encode(e,t,r),t),Ie=e=>Ce.encodingLength(e),_e=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},De=e=>{const t=_e(e),[r,n]=Be(t),[o,i]=Be(t.subarray(n)),s=t.subarray(n+i);if(s.byteLength!==o)throw new Error("Incorrect length");return new Se(r,o,s,t)};class Se{constructor(e,t,r,n){this.code=e,this.size=t,this.digest=r,this.bytes=n}}var Ne=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var o=0;o<e.length;o++){var i=e.charAt(o),s=i.charCodeAt(0);if(255!==r[s])throw new TypeError(i+" is ambiguous");r[s]=o}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),f=Math.log(256)/Math.log(a);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var n=0,o=0;e[t]===c;)n++,t++;for(var i=(e.length-t)*u+1>>>0,s=new Uint8Array(i);e[t];){var f=r[e.charCodeAt(t)];if(255===f)return;for(var l=0,h=i-1;(0!==f||l<o)&&-1!==h;h--,l++)f+=a*s[h]>>>0,s[h]=f%256>>>0,f=f/256>>>0;if(0!==f)throw new Error("Non-zero carry");o=l,t++}if(" "!==e[t]){for(var d=i-o;d!==i&&0===s[d];)d++;for(var p=new Uint8Array(n+(i-d)),w=n;d!==i;)p[w++]=s[d++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var r=0,n=0,o=0,i=t.length;o!==i&&0===t[o];)o++,r++;for(var s=(i-o)*f+1>>>0,u=new Uint8Array(s);o!==i;){for(var l=t[o],h=0,d=s-1;(0!==l||h<n)&&-1!==d;d--,h++)l+=256*u[d]>>>0,u[d]=l%a>>>0,l=l/a>>>0;if(0!==l)throw new Error("Non-zero carry");n=h,o++}for(var p=s-n;p!==s&&0===u[p];)p++;for(var w=c.repeat(r);p<s;++p)w+=e.charAt(u[p]);return w},decodeUnsafe:l,decode:function(e){var r=l(e);if(r)return r;throw new Error(`Non-${t} character`)}}};class Ue{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Re{constructor(e,t,r){this.name=e,this.prefix=t,this.baseDecode=r}decode(e){if("string"!=typeof e)throw Error("Can only multibase decode strings");switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}}or(e){const t={[this.prefix]:this,...e.decoders||{[e.prefix]:e}};return new je(t)}}class je{constructor(e){this.decoders=e}or(e){const t=e.decoders||{[e.prefix]:e};return new je({...this.decoders,...t})}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}class Oe{constructor(e,t,r,n){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=n,this.encoder=new Ue(e,t,r),this.decoder=new Re(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Le=({name:e,prefix:t,encode:r,decode:n})=>new Oe(e,t,r,n),ze=({prefix:e,name:t,alphabet:r})=>{const{encode:n,decode:o}=Ne(r,t);return Le({prefix:e,name:t,encode:n,decode:e=>_e(o(e))})},$e=({name:e,prefix:t,bitsPerChar:r,alphabet:n})=>Le({prefix:t,name:e,encode:e=>((e,t,r)=>{const n="="===t[t.length-1],o=(1<<r)-1;let i="",s=0,a=0;for(let c=0;c<e.length;++c)for(a=a<<8|e[c],s+=8;s>r;)s-=r,i+=t[o&a>>s];if(s&&(i+=t[o&a<<r-s]),n)for(;i.length*r&7;)i+="=";return i})(e,n,r),decode:t=>((e,t,r,n)=>{const o={};for(let f=0;f<t.length;++f)o[t[f]]=f;let i=e.length;for(;"="===e[i-1];)--i;const s=new Uint8Array(i*r/8|0);let a=0,c=0,u=0;for(let f=0;f<i;++f){const t=o[e[f]];if(void 0===t)throw new SyntaxError(`Non-${n} character`);c=c<<r|t,a+=r,a>=8&&(a-=8,s[u++]=255&c>>a)}if(a>=r||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return s})(t,n,r,e)}),Pe=ze({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});ze({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});const Me=$e({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5});$e({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),$e({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$e({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),$e({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),$e({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),$e({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$e({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),$e({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});class He{constructor(e,t,r,n){this.code=t,this.version=e,this.multihash=r,this.bytes=n,this.byteOffset=n.byteOffset,this.byteLength=n.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:Qe,byteLength:Qe,code:Ke,version:Ke,multihash:Ke,bytes:Ke,_baseCache:Qe,asCID:Qe})}toV0(){switch(this.version){case 0:return this;default:{const{code:e,multihash:t}=this;if(e!==qe)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Je)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return He.createV0(t)}}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,r=((e,t)=>{const r=t.byteLength,n=Ie(e),o=n+Ie(r),i=new Uint8Array(o+r);return xe(e,i,0),xe(r,i,n),i.set(t,o),new Se(e,r,t,i)})(e,t);return He.createV1(this.code,r)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&(t=this.multihash,r=e.multihash,t===r||t.code===r.code&&t.size===r.size&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0})(t.bytes,r.bytes));var t,r}toString(e){const{bytes:t,version:r,_baseCache:n}=this;switch(r){case 0:return Ge(t,n,e||Pe.encoder);default:return Ve(t,n,e||Me.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return Ye(/^0\.0/,Ze),!(!e||!e[Xe]&&e.asCID!==e)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof He)return e;if(null!=e&&e.asCID===e){const{version:t,code:r,multihash:n,bytes:o}=e;return new He(t,r,n,o||We(t,r,n.bytes))}if(null!=e&&!0===e[Xe]){const{version:t,multihash:r,code:n}=e,o=De(r);return He.create(t,n,o)}return null}static create(e,t,r){if("number"!=typeof t)throw new Error("String codecs are no longer supported");switch(e){case 0:if(t!==qe)throw new Error(`Version 0 CID must use dag-pb (code: ${qe}) block encoding`);return new He(e,t,r,r.bytes);case 1:{const n=We(e,t,r.bytes);return new He(e,t,r,n)}default:throw new Error("Invalid version")}}static createV0(e){return He.create(0,qe,e)}static createV1(e,t){return He.create(1,e,t)}static decode(e){const[t,r]=He.decodeFirst(e);if(r.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=He.inspectBytes(e),r=t.size-t.multihashSize,n=_e(e.subarray(r,r+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");const o=n.subarray(t.multihashSize-t.digestSize),i=new Se(t.multihashCode,t.digestSize,o,n);return[0===t.version?He.createV0(i):He.createV1(t.codec,i),e.subarray(t.size)]}static inspectBytes(e){let t=0;const r=()=>{const[r,n]=Be(e.subarray(t));return t+=n,r};let n=r(),o=qe;if(18===n?(n=0,t=0):1===n&&(o=r()),0!==n&&1!==n)throw new RangeError(`Invalid CID version ${n}`);const i=t,s=r(),a=r(),c=t+a;return{version:n,codec:o,multihashCode:s,digestSize:a,multihashSize:c-i,size:c}}static parse(e,t){const[r,n]=Fe(e,t),o=He.decode(n);return o._baseCache.set(r,e),o}}const Fe=(e,t)=>{switch(e[0]){case"Q":{const r=t||Pe;return[Pe.prefix,r.decode(`${Pe.prefix}${e}`)]}case Pe.prefix:{const r=t||Pe;return[Pe.prefix,r.decode(e)]}case Me.prefix:{const r=t||Me;return[Me.prefix,r.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Ge=(e,t,r)=>{const{prefix:n}=r;if(n!==Pe.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);const o=t.get(n);if(null==o){const o=r.encode(e).slice(1);return t.set(n,o),o}return o},Ve=(e,t,r)=>{const{prefix:n}=r,o=t.get(n);if(null==o){const o=r.encode(e);return t.set(n,o),o}return o},qe=112,Je=18,We=(e,t,r)=>{const n=Ie(e),o=n+Ie(t),i=new Uint8Array(o+r.byteLength);return xe(e,i,0),xe(t,i,n),i.set(r,o),i},Xe=Symbol.for("@ipld/js-cid/CID"),Ke={writable:!1,configurable:!1,enumerable:!0},Qe={writable:!1,enumerable:!1,configurable:!1},Ye=(e,t)=>{if(!e.test("0.0.0-dev"))throw new Error(t);console.warn(t)},Ze="CID.isCID(v) is deprecated and will be removed in the next major release.\nFollowing code pattern:\n\nif (CID.isCID(value)) {\n  doSomethingWithCID(value)\n}\n\nIs replaced with:\n\nconst cid = CID.asCID(value)\nif (cid) {\n  // Make sure to use cid instead of value\n  doSomethingWithCID(cid)\n}\n",et=["string","number","bigint","symbol"],tt=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function rt(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(et.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const r=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(tt.includes(t))return t;return}(e);return r||"Object"}class nt{constructor(e,t,r){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=r}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}nt.uint=new nt(0,"uint",!0),nt.negint=new nt(1,"negint",!0),nt.bytes=new nt(2,"bytes",!0),nt.string=new nt(3,"string",!0),nt.array=new nt(4,"array",!1),nt.map=new nt(5,"map",!1),nt.tag=new nt(6,"tag",!1),nt.float=new nt(7,"float",!0),nt.false=new nt(7,"false",!0),nt.true=new nt(7,"true",!0),nt.null=new nt(7,"null",!0),nt.undefined=new nt(7,"undefined",!0),nt.break=new nt(7,"break",!0);class ot{constructor(e,t,r){this.type=e,this.value=t,this.encodedLength=r,this.encodedBytes=void 0}toString(){return`Token[${this.type}].${this.value}`}}const it=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,st=new TextDecoder,at=new TextEncoder;function ct(e){return it&&globalThis.Buffer.isBuffer(e)}function ut(e){return e instanceof Uint8Array?ct(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const ft=it?(e,t,r)=>r-t>64?globalThis.Buffer.from(e.subarray(t,r)).toString("utf8"):gt(e,t,r):(e,t,r)=>r-t>64?st.decode(e.subarray(t,r)):gt(e,t,r),lt=it?e=>e.length>64?globalThis.Buffer.from(e):yt(e):e=>e.length>64?at.encode(e):yt(e),ht=e=>Uint8Array.from(e),dt=it?(e,t,r)=>ct(e)?new Uint8Array(e.subarray(t,r)):e.slice(t,r):(e,t,r)=>e.slice(t,r),pt=it?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),ut(globalThis.Buffer.concat(e,t))):(e,t)=>{const r=new Uint8Array(t);let n=0;for(let o of e)n+o.length>r.length&&(o=o.subarray(0,r.length-n)),r.set(o,n),n+=o.length;return r},wt=it?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function yt(e,t=1/0){let r;const n=e.length;let o=null;const i=[];for(let s=0;s<n;++s){if(r=e.charCodeAt(s),r>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function gt(e,t,r){const n=[];for(;t<r;){const o=e[t];let i=null,s=o>239?4:o>223?3:o>191?2:1;if(t+s<=r){let r,n,a,c;switch(s){case 1:o<128&&(i=o);break;case 2:r=e[t+1],128==(192&r)&&(c=(31&o)<<6|63&r,c>127&&(i=c));break;case 3:r=e[t+1],n=e[t+2],128==(192&r)&&128==(192&n)&&(c=(15&o)<<12|(63&r)<<6|63&n,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:r=e[t+1],n=e[t+2],a=e[t+3],128==(192&r)&&128==(192&n)&&128==(192&a)&&(c=(15&o)<<18|(63&r)<<12|(63&n)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,s=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|1023&i),n.push(i),t+=s}return function(e){const t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);let r="",n=0;for(;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=4096));return r}(n)}class bt{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.chunks=[],this.cursor=0,this.maxCursor=-1,null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const r=t.length-(this.maxCursor-this.cursor)-1;t.set(e,r)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=wt(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const r=this.chunks[0];e&&this.cursor>r.length/2?(t=this.cursor===r.length?r:r.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=dt(r,0,this.cursor)}else t=pt(this.chunks,this.cursor);return e&&this.reset(),t}}function mt(e,t,r){if(e.length-t<r)throw new Error("CBOR decode error: not enough data for type")}const vt=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Et(e,t,r){mt(e,t,1);const n=e[t];if(!0===r.strict&&n<vt[0])throw new Error("CBOR decode error: integer encoded in more bytes than necessary (strict decode)");return n}function kt(e,t,r){mt(e,t,2);const n=e[t]<<8|e[t+1];if(!0===r.strict&&n<vt[1])throw new Error("CBOR decode error: integer encoded in more bytes than necessary (strict decode)");return n}function At(e,t,r){mt(e,t,4);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===r.strict&&n<vt[2])throw new Error("CBOR decode error: integer encoded in more bytes than necessary (strict decode)");return n}function Tt(e,t,r){mt(e,t,8);const n=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],o=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(n)<<BigInt(32))+BigInt(o);if(!0===r.strict&&i<vt[3])throw new Error("CBOR decode error: integer encoded in more bytes than necessary (strict decode)");if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(!0===r.allowBigInt)return i;throw new Error("CBOR decode error: integers outside of the safe integer range are not supported")}function Ct(e,t){return Bt(e,0,t.value)}function Bt(e,t,r){if(r<vt[0]){const n=Number(r);e.push([t|n])}else if(r<vt[1]){const n=Number(r);e.push([24|t,n])}else if(r<vt[2]){const n=Number(r);e.push([25|t,n>>>8,255&n])}else if(r<vt[3]){const n=Number(r);e.push([26|t,n>>>24&255,n>>>16&255,n>>>8&255,255&n])}else{const n=BigInt(r);if(!(n<vt[4]))throw new Error("CBOR decode error: encountered BigInt larger than allowable range");{const r=[27|t,0,0,0,0,0,0,0];let o=Number(n&BigInt(4294967295)),i=Number(n>>BigInt(32)&BigInt(4294967295));r[8]=255&o,o>>=8,r[7]=255&o,o>>=8,r[6]=255&o,o>>=8,r[5]=255&o,r[4]=255&i,i>>=8,r[3]=255&i,i>>=8,r[2]=255&i,i>>=8,r[1]=255&i,e.push(r)}}}Ct.encodedSize=function(e){return Bt.encodedSize(e.value)},Bt.encodedSize=function(e){return e<vt[0]?1:e<vt[1]?2:e<vt[2]?3:e<vt[3]?5:9},Ct.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const xt=BigInt(-1),It=BigInt(1);function _t(e,t){const r=t.value,n="bigint"==typeof r?r*xt-It:-1*r-1;Bt(e,t.type.majorEncoded,n)}function Dt(e,t,r,n){mt(e,t,r+n);const o=dt(e,t+r,t+r+n);return new ot(nt.bytes,o,r+n)}function St(e,t,r,n){return Dt(e,t,1,r)}function Nt(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===nt.string?lt(e.value):e.value),e.encodedBytes}function Ut(e,t){const r=Nt(t);Bt(e,t.type.majorEncoded,r.length),e.push(r)}function Rt(e,t,r,n){const o=r+n;return mt(e,t,o),new ot(nt.string,ft(e,t+r,t+o),o)}function jt(e,t,r,n){return Rt(e,t,1,r)}_t.encodedSize=function(e){const t=e.value,r="bigint"==typeof t?t*xt-It:-1*t-1;return r<vt[0]?1:r<vt[1]?2:r<vt[2]?3:r<vt[3]?5:9},_t.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Ut.encodedSize=function(e){const t=Nt(e);return Bt.encodedSize(t.length)+t.length},Ut.compareTokens=function(e,t){return r=Nt(e),n=Nt(t),r.length<n.length?-1:r.length>n.length?1:function(e,t){if(ct(e)&&ct(t))return e.compare(t);for(let r=0;r<e.length;r++)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return 0}(r,n);var r,n};const Ot=Ut;function Lt(e,t,r,n){return new ot(nt.array,n,r)}function zt(e,t,r,n){return Lt(0,0,1,r)}function $t(e,t){Bt(e,nt.array.majorEncoded,t.value)}function Pt(e,t,r,n){return new ot(nt.map,n,r)}function Mt(e,t,r,n){return Pt(0,0,1,r)}function Ht(e,t){Bt(e,nt.map.majorEncoded,t.value)}function Ft(e,t,r,n){return new ot(nt.tag,r,1)}function Gt(e,t){Bt(e,nt.tag.majorEncoded,t.value)}$t.compareTokens=Ct.compareTokens,Ht.compareTokens=Ct.compareTokens,Gt.compareTokens=Ct.compareTokens;function Vt(e,t,r){if(r){if(!1===r.allowNaN&&Number.isNaN(e))throw new Error("CBOR decode error: NaN values are not supported");if(!1===r.allowInfinity&&(e===1/0||e===-1/0))throw new Error("CBOR decode error: Infinity values are not supported")}return new ot(nt.float,e,t)}function qt(e,t,r){const n=t.value;if(!1===n)e.push([20|nt.float.majorEncoded]);else if(!0===n)e.push([21|nt.float.majorEncoded]);else if(null===n)e.push([22|nt.float.majorEncoded]);else if(void 0===n)e.push([23|nt.float.majorEncoded]);else{let t,i=!1;r&&!0===r.float64||(Kt(n),t=Qt(Xt,1),n===t||Number.isNaN(n)?(Xt[0]=249,e.push(Xt.slice(0,3)),i=!0):(Yt(n),t=Zt(Xt,1),n===t&&(Xt[0]=250,e.push(Xt.slice(0,5)),i=!0))),i||(o=n,Wt.setFloat64(0,o,!1),t=er(Xt,1),Xt[0]=251,e.push(Xt.slice(0,9)))}var o}qt.encodedSize=function(e,t){const r=e.value;if(!1===r||!0===r||null==r)return 1;let n;if(!t||!0!==t.float64){if(Kt(r),n=Qt(Xt,1),r===n||Number.isNaN(r))return 3;if(Yt(r),n=Zt(Xt,1),r===n)return 5}return 9};const Jt=new ArrayBuffer(9),Wt=new DataView(Jt,1),Xt=new Uint8Array(Jt,0);function Kt(e){if(e===1/0)Wt.setUint16(0,31744,!1);else if(e===-1/0)Wt.setUint16(0,64512,!1);else if(Number.isNaN(e))Wt.setUint16(0,32256,!1);else{Wt.setFloat32(0,e);const t=Wt.getUint32(0),r=(2139095040&t)>>23,n=8388607&t;if(255===r)Wt.setUint16(0,31744,!1);else if(0===r)Wt.setUint16(0,(2147483648&e)>>16|n>>13,!1);else{const e=r-127;e<-24?Wt.setUint16(0,0):e<-14?Wt.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):Wt.setUint16(0,(2147483648&t)>>16|e+15<<10|n>>13,!1)}}}function Qt(e,t){if(e.length-t<2)throw new Error("CBOR decode error: not enough data for float16");const r=(e[t]<<8)+e[t+1];if(31744===r)return 1/0;if(64512===r)return-1/0;if(32256===r)return NaN;const n=r>>10&31,o=1023&r;let i;return i=0===n?o*2**-24:31!==n?(o+1024)*2**(n-25):0===o?1/0:NaN,32768&r?-i:i}function Yt(e){Wt.setFloat32(0,e,!1)}function Zt(e,t){if(e.length-t<4)throw new Error("CBOR decode error: not enough data for float32");const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,4).getFloat32(0,!1)}function er(e,t){if(e.length-t<8)throw new Error("CBOR decode error: not enough data for float64");const r=(e.byteOffset||0)+t;return new DataView(e.buffer,r,8).getFloat64(0,!1)}function tr(e,t,r){throw new Error(`CBOR decode error: encountered invalid minor (${r}) for major ${e[t]>>>5}`)}function rr(e){return()=>{throw new Error(`CBOR decode error: ${e}`)}}qt.compareTokens=Ct.compareTokens;const nr=[];for(let zn=0;zn<=23;zn++)nr[zn]=tr;nr[24]=function(e,t,r,n){return new ot(nt.uint,Et(e,t+1,n),2)},nr[25]=function(e,t,r,n){return new ot(nt.uint,kt(e,t+1,n),3)},nr[26]=function(e,t,r,n){return new ot(nt.uint,At(e,t+1,n),5)},nr[27]=function(e,t,r,n){return new ot(nt.uint,Tt(e,t+1,n),9)},nr[28]=tr,nr[29]=tr,nr[30]=tr,nr[31]=tr;for(let zn=32;zn<=55;zn++)nr[zn]=tr;nr[56]=function(e,t,r,n){return new ot(nt.negint,-1-Et(e,t+1,n),2)},nr[57]=function(e,t,r,n){return new ot(nt.negint,-1-kt(e,t+1,n),3)},nr[58]=function(e,t,r,n){return new ot(nt.negint,-1-At(e,t+1,n),5)},nr[59]=function(e,t,r,n){const o=Tt(e,t+1,n);if("bigint"!=typeof o){const e=-1-o;if(e>=Number.MIN_SAFE_INTEGER)return new ot(nt.negint,e,9)}if(!0!==n.allowBigInt)throw new Error("CBOR decode error: integers outside of the safe integer range are not supported");return new ot(nt.negint,xt-BigInt(o),9)},nr[60]=tr,nr[61]=tr,nr[62]=tr,nr[63]=tr;for(let zn=64;zn<=87;zn++)nr[zn]=St;nr[88]=function(e,t,r,n){return Dt(e,t,2,Et(e,t+1,n))},nr[89]=function(e,t,r,n){return Dt(e,t,3,kt(e,t+1,n))},nr[90]=function(e,t,r,n){return Dt(e,t,5,At(e,t+1,n))},nr[91]=function(e,t,r,n){const o=Tt(e,t+1,n);if("bigint"==typeof o)throw new Error("CBOR decode error: 64-bit integer bytes lengths not supported");return Dt(e,t,9,o)},nr[92]=tr,nr[93]=tr,nr[94]=tr,nr[95]=rr("indefinite length bytes/strings are not supported");for(let zn=96;zn<=119;zn++)nr[zn]=jt;nr[120]=function(e,t,r,n){return Rt(e,t,2,Et(e,t+1,n))},nr[121]=function(e,t,r,n){return Rt(e,t,3,kt(e,t+1,n))},nr[122]=function(e,t,r,n){return Rt(e,t,5,At(e,t+1,n))},nr[123]=function(e,t,r,n){const o=Tt(e,t+1,n);if("bigint"==typeof o)throw new Error("CBOR decode error: 64-bit integer string lengths not supported");return Rt(e,t,9,o)},nr[124]=tr,nr[125]=tr,nr[126]=tr,nr[127]=rr("indefinite length bytes/strings are not supported");for(let zn=128;zn<=151;zn++)nr[zn]=zt;nr[152]=function(e,t,r,n){return Lt(0,0,2,Et(e,t+1,n))},nr[153]=function(e,t,r,n){return Lt(0,0,3,kt(e,t+1,n))},nr[154]=function(e,t,r,n){return Lt(0,0,5,At(e,t+1,n))},nr[155]=function(e,t,r,n){const o=Tt(e,t+1,n);if("bigint"==typeof o)throw new Error("CBOR decode error: 64-bit integer array lengths not supported");return Lt(0,0,9,o)},nr[156]=tr,nr[157]=tr,nr[158]=tr,nr[159]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error("CBOR decode error: indefinite length items not allowed");return Lt(0,0,1,1/0)};for(let zn=160;zn<=183;zn++)nr[zn]=Mt;nr[184]=function(e,t,r,n){return Pt(0,0,2,Et(e,t+1,n))},nr[185]=function(e,t,r,n){return Pt(0,0,3,kt(e,t+1,n))},nr[186]=function(e,t,r,n){return Pt(0,0,5,At(e,t+1,n))},nr[187]=function(e,t,r,n){const o=Tt(e,t+1,n);if("bigint"==typeof o)throw new Error("CBOR decode error: 64-bit integer map lengths not supported");return Pt(0,0,9,o)},nr[188]=tr,nr[189]=tr,nr[190]=tr,nr[191]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error("CBOR decode error: indefinite length items not allowed");return Pt(0,0,1,1/0)};for(let zn=192;zn<=215;zn++)nr[zn]=Ft;nr[216]=function(e,t,r,n){return new ot(nt.tag,Et(e,t+1,n),2)},nr[217]=function(e,t,r,n){return new ot(nt.tag,kt(e,t+1,n),3)},nr[218]=function(e,t,r,n){return new ot(nt.tag,At(e,t+1,n),5)},nr[219]=function(e,t,r,n){return new ot(nt.tag,Tt(e,t+1,n),9)},nr[220]=tr,nr[221]=tr,nr[222]=tr,nr[223]=tr;for(let zn=224;zn<=243;zn++)nr[zn]=rr("simple values are not supported");nr[244]=tr,nr[245]=tr,nr[246]=tr,nr[247]=function(e,t,r,n){if(!1===n.allowUndefined)throw new Error("CBOR decode error: undefined values are not supported");return new ot(nt.undefined,void 0,1)},nr[248]=rr("simple values are not supported"),nr[249]=function(e,t,r,n){return Vt(Qt(e,t+1),3,n)},nr[250]=function(e,t,r,n){return Vt(Zt(e,t+1),5,n)},nr[251]=function(e,t,r,n){return Vt(er(e,t+1),9,n)},nr[252]=tr,nr[253]=tr,nr[254]=tr,nr[255]=function(e,t,r,n){if(!1===n.allowIndefinite)throw new Error("CBOR decode error: indefinite length items not allowed");return new ot(nt.break,void 0,1)};const or=[];for(let zn=0;zn<24;zn++)or[zn]=new ot(nt.uint,zn,1);for(let zn=-1;zn>=-24;zn--)or[31-zn]=new ot(nt.negint,zn,1);or[64]=new ot(nt.bytes,new Uint8Array(0),1),or[96]=new ot(nt.string,"",1),or[128]=new ot(nt.array,0,1),or[160]=new ot(nt.map,0,1),or[244]=new ot(nt.false,!1,1),or[245]=new ot(nt.true,!0,1),or[246]=new ot(nt.null,null,1);const ir={float64:!1,mapSorter:function(e,t){const r=Array.isArray(e[0])?e[0][0]:e[0],n=Array.isArray(t[0])?t[0][0]:t[0];if(r.type!==n.type)return r.type.compare(n.type);const o=r.type.major,i=sr[o].compareTokens(r,n);0===i&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return i},quickEncodeToken:function(e){switch(e.type){case nt.false:return ht([244]);case nt.true:return ht([245]);case nt.null:return ht([246]);case nt.bytes:return e.value.length?void 0:ht([64]);case nt.string:return""===e.value?ht([96]):void 0;case nt.array:return 0===e.value?ht([128]):void 0;case nt.map:return 0===e.value?ht([160]):void 0;case nt.uint:return e.value<24?ht([Number(e.value)]):void 0;case nt.negint:if(e.value>=-24)return ht([31-Number(e.value)])}}},sr=[];sr[nt.uint.major]=Ct,sr[nt.negint.major]=_t,sr[nt.bytes.major]=Ut,sr[nt.string.major]=Ot,sr[nt.array.major]=$t,sr[nt.map.major]=Ht,sr[nt.tag.major]=Gt,sr[nt.float.major]=qt;const ar=new bt;class cr{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error("CBOR encode error: object contains circular references");return new cr(t,e)}}const ur={null:new ot(nt.null,null),undefined:new ot(nt.undefined,void 0),true:new ot(nt.true,!0),false:new ot(nt.false,!1),emptyArray:new ot(nt.array,0),emptyMap:new ot(nt.map,0)},fr={number:(e,t,r,n)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new ot(e>=0?nt.uint:nt.negint,e):new ot(nt.float,e),bigint:(e,t,r,n)=>e>=BigInt(0)?new ot(nt.uint,e):new ot(nt.negint,e),Uint8Array:(e,t,r,n)=>new ot(nt.bytes,e),string:(e,t,r,n)=>new ot(nt.string,e),boolean:(e,t,r,n)=>e?ur.true:ur.false,null:(e,t,r,n)=>ur.null,undefined:(e,t,r,n)=>ur.undefined,ArrayBuffer:(e,t,r,n)=>new ot(nt.bytes,new Uint8Array(e)),DataView:(e,t,r,n)=>new ot(nt.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,r,n){if(!e.length)return!0===r.addBreakTokens?[ur.emptyArray,new ot(nt.break)]:ur.emptyArray;n=cr.createCheck(n,e);const o=[];let i=0;for(const s of e)o[i++]=lr(s,r,n);return r.addBreakTokens?[new ot(nt.array,e.length),o,new ot(nt.break)]:[new ot(nt.array,e.length),o]},Object(e,t,r,n){const o="Object"!==t,i=o?e.keys():Object.keys(e),s=o?e.size:i.length;if(!s)return!0===r.addBreakTokens?[ur.emptyMap,new ot(nt.break)]:ur.emptyMap;n=cr.createCheck(n,e);const a=[];let c=0;for(const u of i)a[c++]=[lr(u,r,n),lr(o?e.get(u):e[u],r,n)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(a,r),r.addBreakTokens?[new ot(nt.map,s),a,new ot(nt.break)]:[new ot(nt.map,s),a]}};fr.Map=fr.Object,fr.Buffer=fr.Uint8Array;for(const zn of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))fr[`${zn}Array`]=fr.DataView;function lr(e,t={},r){const n=rt(e),o=t&&t.typeEncoders&&t.typeEncoders[n]||fr[n];if("function"==typeof o){const i=o(e,n,t,r);if(null!=i)return i}const i=fr[n];if(!i)throw new Error(`CBOR encode error: unsupported type: ${n}`);return i(e,n,t,r)}function hr(e,t,r,n){if(Array.isArray(t))for(const o of t)hr(e,o,r,n);else r[t.type.major](e,t,n)}function dr(e,t,r){const n=lr(e,r);if(!Array.isArray(n)&&r.quickEncodeToken){const e=r.quickEncodeToken(n);if(e)return e;const o=t[n.type.major];if(o.encodedSize){const e=o.encodedSize(n,r),t=new bt(e);if(o(t,n,r),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return ut(t.chunks[0])}}return hr(ar,n,t,r),ar.toBytes(!0)}const pr={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class wr{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=or[e];if(void 0===t){const r=nr[e];if(!r)throw new Error(`CBOR decode error: no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const n=31&e;t=r(this.data,this.pos,n,this.options)}return this.pos+=t.encodedLength,t}}const yr=Symbol.for("DONE"),gr=Symbol.for("BREAK");function br(e,t){if(e.done())return yr;const r=e.next();if(r.type===nt.break)return gr;if(r.type.terminal)return r.value;if(r.type===nt.array)return function(e,t,r){const n=[];for(let o=0;o<e.value;o++){const i=br(t,r);if(i===gr){if(e.value===1/0)break;throw new Error("CBOR decode error: got unexpected break to lengthed array")}if(i===yr)throw new Error(`CBOR decode error: found array but not enough entries (got ${o}, expected ${e.value})`);n[o]=i}return n}(r,e,t);if(r.type===nt.map)return function(e,t,r){const n=!0===r.useMaps,o=n?void 0:{},i=n?new Map:void 0;for(let s=0;s<e.value;s++){const a=br(t,r);if(a===gr){if(e.value===1/0)break;throw new Error("CBOR decode error: got unexpected break to lengthed map")}if(a===yr)throw new Error(`CBOR decode error: found map but not enough entries (got ${s} [no key], expected ${e.value})`);if(!0!==n&&"string"!=typeof a)throw new Error(`CBOR decode error: non-string keys not supported (got ${typeof a})`);const c=br(t,r);if(c===yr)throw new Error(`CBOR decode error: found map but not enough entries (got ${s} [no value], expected ${e.value})`);n?i.set(a,c):o[a]=c}return n?i:o}(r,e,t);if(r.type===nt.tag){if(t.tags&&"function"==typeof t.tags[r.value]){const n=br(e,t);return t.tags[r.value](n)}throw new Error(`CBOR decode error: tag not supported (${r.value})`)}throw new Error("unsupported")}const mr={float64:!0,typeEncoders:{Object:function(e){if(e.asCID!==e)return null;const t=He.asCID(e);if(!t)return null;const r=new Uint8Array(t.bytes.byteLength+1);return r.set(t.bytes,1),[new ot(nt.tag,42),new ot(nt.bytes,r)]},undefined:function(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}};const vr={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};vr.tags[42]=function(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return He.decode(e.subarray(1))};const Er=e=>{return t=e,r=mr,r=Object.assign({},ir,r),dr(t,sr,r);var t,r},kr=e=>function(e,t){if(!(e instanceof Uint8Array))throw new Error("CBOR decode error: data to decode must be a Uint8Array");const r=(t=Object.assign({},pr,t)).tokenizer||new wr(e,t),n=br(r,t);if(n===yr)throw new Error("CBOR decode error: did not find any content to decode");if(n===gr)throw new Error("CBOR decode error: got unexpected break");if(!r.done())throw new Error("CBOR decode error: too many terminals, data makes no sense");return n}(e,vr);var Ar=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",name:"dag-cbor",code:113,encode:Er,decode:kr});const Tr=18,Cr=32,Br=112;async function xr(e){const t=await e.upTo(8),r=he.decode(t);return e.seek(he.decode.bytes),r}async function Ir(e){const t=await xr(e);if(0===t)throw new Error("Invalid CAR header (zero length)");const r=await e.exactly(t);e.seek(t);const n=kr(r);if(null==n||Array.isArray(n)||"object"!=typeof n)throw new Error("Invalid CAR header format");if(1!==n.version){if("string"==typeof n.version)throw new Error(`Invalid CAR version: "${n.version}"`);throw new Error(`Invalid CAR version: ${n.version}`)}if(!Array.isArray(n.roots))throw new Error("Invalid CAR header format");if(Object.keys(n).filter((e=>"roots"!==e&&"version"!==e)).length)throw new Error("Invalid CAR header format");return n}async function _r(e){const t=await e.exactly(2);if(t[0]===Tr&&t[1]===Cr){const t=await e.exactly(34);e.seek(34);const r=De(t);return He.create(0,Br,r)}const r=await xr(e);if(1!==r)throw new Error(`Unexpected CID version (${r})`);const n=await xr(e),o=await async function(e){const t=await e.upTo(8);he.decode(t);const r=he.decode.bytes,n=he.decode(t.subarray(he.decode.bytes)),o=r+he.decode.bytes+n,i=await e.exactly(o);return e.seek(o),i}(e),i=De(o);return He.create(r,n,i)}async function Dr(e){const t=e.pos;let r=await xr(e);if(0===r)throw new Error("Invalid CAR section (zero length)");r+=e.pos-t;return{cid:await _r(e),length:r,blockLength:r-(e.pos-t)}}async function Sr(e){const{cid:t,blockLength:r}=await Dr(e),n=await e.exactly(r);return e.seek(r),{bytes:n,cid:t}}async function Nr(e){const t=e.pos,{cid:r,length:n,blockLength:o}=await Dr(e),i={cid:r,length:n,blockLength:o,offset:t,blockOffset:e.pos};return e.seek(i.blockLength),i}function Ur(e){let t=0;return{upTo:async r=>e.subarray(t,t+Math.min(r,e.length-t)),async exactly(r){if(r>e.length-t)throw new Error("Unexpected end of data");return e.subarray(t,t+r)},seek(e){t+=e},get pos(){return t}}}function Rr(e){const t=e[Symbol.asyncIterator]();return function(e){let t=0,r=0,n=0,o=new Uint8Array(0);const i=async t=>{r=o.length-n;const i=[o.subarray(n)];for(;r<t;){const t=await e();if(null==t)break;r<0?t.length>r&&i.push(t.subarray(-r)):i.push(t),r+=t.length}o=new Uint8Array(i.reduce(((e,t)=>e+t.length),0));let s=0;for(const e of i)o.set(e,s),s+=e.length;n=0};return{upTo:async e=>(o.length-n<e&&await i(e),o.subarray(n,n+Math.min(o.length-n,e))),async exactly(e){if(o.length-n<e&&await i(e),o.length-n<e)throw new Error("Unexpected end of data");return o.subarray(n,n+e)},seek(e){t+=e,n+=e},get pos(){return t}}}((async function(){const e=await t.next();return e.done?null:e.value}))}class jr{constructor(e,t,r){this._version=e,this._roots=t,this._blocks=r,this._keys=r.map((e=>e.cid.toString()))}get version(){return this._version}async getRoots(){return this._roots}async has(e){return this._keys.indexOf(e.toString())>-1}async get(e){const t=this._keys.indexOf(e.toString());return t>-1?this._blocks[t]:void 0}async*blocks(){for(const e of this._blocks)yield e}async*cids(){for(const e of this._blocks)yield e.cid}static async fromBytes(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return Or(Ur(e))}static async fromIterable(e){if(!e||"function"!=typeof e[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return Or(Rr(e))}}async function Or(e){const t=function(e){const t=Ir(e);return{header:()=>t,async*blocks(){for(await t;(await e.upTo(8)).length>0;)yield await Sr(e)},async*blocksIndex(){for(await t;(await e.upTo(8)).length>0;)yield await Nr(e)}}}(e),{version:r,roots:n}=await t.header(),o=[];for await(const i of t.blocks())o.push(i);return new jr(r,n,o)}function Lr(e){const t=Er({version:1,roots:e}),r=he.encode(t.length),n=new Uint8Array(r.length+t.length);return n.set(r,0),n.set(t,r.length),n}function zr(){}class $r{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array&&e.cid))throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");const t=He.asCID(e.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then((()=>this._encoder.writeBlock({cid:t,bytes:e.bytes}))),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(e){e=function(e){if(void 0===e)return[];if(!Array.isArray(e)){const t=He.asCID(e);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}const t=[];for(const r of e){const e=He.asCID(r);if(!e)throw new TypeError("roots must be a single CID or an array of CIDs");t.push(e)}return t}(e);const{encoder:t,iterator:r}=Mr();return{writer:new $r(e,t),out:new Pr(r)}}static createAppender(){const{encoder:e,iterator:t}=Mr();e.setRoots=()=>Promise.resolve();return{writer:new $r([],e),out:new Pr(t)}}static async updateRootsInBytes(e,t){const r=Ur(e);await Ir(r);const n=Lr(t);if(r.pos!==n.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${r.pos} bytes, new header is ${n.length} bytes)`);return e.set(n,0),e}}class Pr{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function Mr(){const e=function(){const e=[];let t=null,r=zr,n=!1,o=null,i=zr;const s=()=>(t||(t=new Promise((e=>{r=()=>{t=null,r=zr,e()}}))),t),a={async next(){const t=e.shift();return t?(0===e.length&&r(),{done:!1,value:t}):n?(r(),{done:!0,value:void 0}):(o||(o=new Promise((e=>{i=()=>(o=null,i=zr,e(a.next()))}))),o)}};return{writer:{write(t){e.push(t);const r=s();return i(),r},async end(){n=!0;const e=s();return i(),e}},iterator:a}}(),{writer:t,iterator:r}=e;return{encoder:function(e){return{async setRoots(t){const r=Lr(t);await e.write(r)},async writeBlock(t){const{cid:r,bytes:n}=t;await e.write(new Uint8Array(he.encode(r.bytes.length+n.length))),await e.write(r.bytes),n.length&&await e.write(n)},close:async()=>e.end()}}(t),iterator:r}}const Hr=({enumerable:e=!0,configurable:t=!1}={})=>({enumerable:e,configurable:t,writable:!1}),Fr=function*(e,t){if(null!=e&&!(e instanceof Uint8Array))for(const[r,n]of Object.entries(e)){const e=[...t,r];if(null!=n&&"object"==typeof n)if(Array.isArray(n))for(const[t,r]of n.entries()){const n=[...e,t],o=He.asCID(r);o?yield[n.join("/"),o]:"object"==typeof r&&(yield*Fr(r,n))}else{const t=He.asCID(n);t?yield[e.join("/"),t]:yield*Fr(n,e)}}},Gr=function*(e,t){if(null!=e)for(const[r,n]of Object.entries(e)){const e=[...t,r];if(yield e.join("/"),!(null==n||n instanceof Uint8Array||"object"!=typeof n||He.asCID(n)))if(Array.isArray(n))for(const[t,r]of n.entries()){const n=[...e,t];yield n.join("/"),"object"!=typeof r||He.asCID(r)||(yield*Gr(r,n))}else yield*Gr(n,e)}};class Vr{constructor({cid:e,bytes:t,value:r}){if(!e||!t||void 0===r)throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:Hr(),bytes:Hr(),value:Hr(),asBlock:Hr()})}links(){return Fr(this.value,[])}tree(){return Gr(this.value,[])}get(e="/"){return((e,t)=>{let r=e;for(const[n,o]of t.entries()){if(r=r[o],null==r)throw new Error(`Object has no property at ${t.slice(0,n+1).map((e=>`[${JSON.stringify(e)}]`)).join("")}`);const e=He.asCID(r);if(e)return{value:e,remaining:t.slice(n+1).join("/")}}return{value:r}})(this.value,e.split("/").filter(Boolean))}}var qr=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",name:"raw",code:85,encode:e=>_e(e),decode:e=>_e(e)});const Jr=new TextDecoder;function Wr(e,t){let r=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const o=e[t++];if(r+=n<28?(127&o)<<n:(127&o)*2**n,o<128)break}return[r,t]}function Xr(e,t){let r;[r,t]=Wr(e,t);const n=t+r;if(r<0||n<0)throw new Error("protobuf: invalid length");if(n>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,n),n]}function Kr(e,t){let r;return[r,t]=Wr(e,t),[7&r,r>>3,t]}function Qr(e){const t={},r=e.length;let n=0;for(;n<r;){let r,o;if([r,o,n]=Kr(e,n),1===o){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,n]=Xr(e,n)}else if(2===o){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=Xr(e,n),t.Name=Jr.decode(o)}else{if(3!==o)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${o}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==r)throw new Error(`protobuf: (PBLink) wrong wireType (${r}) for Tsize`);[t.Tsize,n]=Wr(e,n)}}if(n>r)throw new Error("protobuf: (PBLink) unexpected end of data");return t}const Yr=new TextEncoder;function Zr(e,t){let r=t.length;if("number"==typeof e.Tsize){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");r=rn(t,r,e.Tsize)-1,t[r]=24}if("string"==typeof e.Name){const n=Yr.encode(e.Name);r-=n.length,t.set(n,r),r=rn(t,r,n.length)-1,t[r]=18}return e.Hash&&(r-=e.Hash.length,t.set(e.Hash,r),r=rn(t,r,e.Hash.length)-1,t[r]=10),t.length-r}function en(e){const t=function(e){let t=0;if(e.Data){const r=e.Data.length;t+=1+r+nn(r)}if(e.Links)for(const r of e.Links){const e=tn(r);t+=1+e+nn(e)}return t}(e),r=new Uint8Array(t);let n=t;if(e.Data&&(n-=e.Data.length,r.set(e.Data,n),n=rn(r,n,e.Data.length)-1,r[n]=10),e.Links)for(let o=e.Links.length-1;o>=0;o--){const t=Zr(e.Links[o],r.subarray(0,n));n-=t,n=rn(r,n,t)-1,r[n]=18}return r}function tn(e){let t=0;if(e.Hash){const r=e.Hash.length;t+=1+r+nn(r)}if("string"==typeof e.Name){const r=Yr.encode(e.Name).length;t+=1+r+nn(r)}return"number"==typeof e.Tsize&&(t+=1+nn(e.Tsize)),t}function rn(e,t,r){const n=t-=nn(r);for(;r>=2147483648;)e[t++]=127&r|128,r/=128;for(;r>=128;)e[t++]=127&r|128,r>>>=7;return e[t]=r,n}function nn(e){return e%2==0&&e++,Math.floor((function(e){let t=0;e>=4294967296&&(e=Math.floor(e/4294967296),t=32);e>=65536&&(e>>>=16,t+=16);e>=256&&(e>>>=8,t+=8);return t+on[e]}(e)+6)/7)}const on=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],sn=["Data","Links"],an=["Hash","Name","Tsize"],cn=new TextEncoder;function un(e,t){if(e===t)return 0;const r=e.Name?cn.encode(e.Name):[],n=t.Name?cn.encode(t.Name):[];let o=r.length,i=n.length;for(let s=0,a=Math.min(o,i);s<a;++s)if(r[s]!==n[s]){o=r[s],i=n[s];break}return o<i?-1:i<o?1:0}function fn(e,t){return!Object.keys(e).some((e=>!t.includes(e)))}function ln(e){if("object"==typeof e.asCID){const t=He.asCID(e);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(e.Hash){let n=He.asCID(e.Hash);try{n||("string"==typeof e.Hash?n=He.parse(e.Hash):e.Hash instanceof Uint8Array&&(n=He.decode(e.Hash)))}catch(r){throw new TypeError(`Invalid DAG-PB form: ${r.message}`)}n&&(t.Hash=n)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return"string"==typeof e.Name&&(t.Name=e.Name),"number"==typeof e.Tsize&&(t.Tsize=e.Tsize),t}function hn(e){if((e instanceof Uint8Array||"string"==typeof e)&&(e={Data:e}),"object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(void 0!==e.Data)if("string"==typeof e.Data)t.Data=cn.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(void 0!==e.Links){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(ln),t.Links.sort(un)}else t.Links=[];return t}function dn(e){if(!e||"object"!=typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");if(!fn(e,sn))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let t=0;t<e.Links.length;t++){const r=e.Links[t];if(!r||"object"!=typeof r||Array.isArray(r))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!fn(r,an))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!r.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(r.Hash.asCID!==r.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==r.Name&&"string"!=typeof r.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==r.Tsize&&("number"!=typeof r.Tsize||r.Tsize%1!=0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t>0&&-1===un(r,e.Links[t-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}var pn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",name:"dag-pb",code:112,encode:function(e){dn(e);const t={};return e.Links&&(t.Links=e.Links.map((e=>{const t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),e.Data&&(t.Data=e.Data),en(t)},decode:function(e){const t=function(e){const t=e.length;let r,n,o=0,i=!1;for(;o<t;){let t,s;if([t,s,o]=Kr(e,o),2!==t)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${t}`);if(1===s){if(n)throw new Error("protobuf: (PBNode) duplicate Data section");[n,o]=Xr(e,o),r&&(i=!0)}else{if(2!==s)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${s}`);{if(i)throw new Error("protobuf: (PBNode) duplicate Links section");let t;r||(r=[]),[t,o]=Xr(e,o),r.push(Qr(t))}}}if(o>t)throw new Error("protobuf: (PBNode) unexpected end of data");const s={};return n&&(s.Data=n),s.Links=r||[],s}(e),r={};return t.Data&&(r.Data=t.Data),t.Links&&(r.Links=t.Links.map((e=>{const t={};try{t.Hash=He.decode(e.Hash)}catch(r){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),r},prepare:hn,validate:dn,createNode:function(e,t=[]){return hn({Data:e,Links:t})},createLink:function(e,t,r){return ln({Hash:r,Name:e,Tsize:t})}});class wn{constructor(e,t,r={}){if("number"!=typeof t||t<=0)throw new Error("invalid target chunk size");this._reader=e,this._targetSize=t,this._decoders=[pn,qr,Ar,...r.decoders||[]]}async*cars(){const e=await this._reader.getRoots();if(1!==e.length)throw new Error(`unexpected number of roots: ${e.length}`);let t;for await(const r of this._cars(e[0]))t=r.channel,r.out&&(yield r.out);if(!t)throw new Error("missing CAR writer channel");t.writer.close(),yield t.out}async _get(e){const t=await this._reader.get(e);if(!t)throw new Error(`missing block for ${e}`);const{bytes:r}=t,n=this._decoders.find((t=>t.code===e.code));if(!n)throw new Error(`missing decoder for ${e.code}`);return new Vr({cid:e,bytes:r,value:n.decode(r)})}async*_cars(e,t=[],r){const n=await this._get(e);if((r=r||Object.assign($r.create(e),{size:0})).size>0&&r.size+n.bytes.byteLength>=this._targetSize){r.writer.close();const{out:e}=r;r=function(e){const t=Object.assign($r.create(e[0].cid),{size:e.reduce(((e,t)=>e+t.bytes.byteLength),0)});for(const r of e)t.writer.put(r);return t}(t),yield{channel:r,out:e}}t=t.concat(n),r.size+=n.bytes.byteLength,r.writer.put(n);for(const[,o]of n.links())for await(const e of this._cars(o,t,r))r=e.channel,yield e;if(!r)throw new Error("missing CAR writer channel");yield{channel:r}}static async fromIterable(e,t,r){const n=await jr.fromIterable(e);return new wn(n,t,r)}static async fromBlob(e,t,r){const n=await e.arrayBuffer(),o=await jr.fromBytes(new Uint8Array(n));return new wn(o,t,r)}}const yn=globalThis.fetch,gn=globalThis.FormData,bn=globalThis.Blob,mn=globalThis.File,vn=new URL("https://dweb.link/"),En=(e,t={})=>{const r=t.gateway||vn;return"ipfs:"===(e=new URL(String(e))).protocol?new URL(`/ipfs/${e.href.slice("ipfs://".length)}`,r):e};class kn{constructor(e,t,r){this.ipnft=e,this.url=t,this.data=r,Object.defineProperties(this,{ipnft:{enumerable:!0,writable:!1},url:{enumerable:!0,writable:!1},data:{enumerable:!1,writable:!1}})}embed(){return kn.embed(this)}static embed({data:e}){return An(e,{gateway:vn})}}const An=(e,t)=>Dn(e,Tn,Bn,t),Tn=e=>e instanceof URL,Cn=(e,t)=>[e,new URL(t)],Bn=(e,t)=>[e,En(t,e)],xn=(e,t,r)=>"string"==typeof e&&t.has(r.join(".")),In=(e,t,r)=>(e.set(r.join("."),t),[e,void 0]),_n=e=>e instanceof bn,Dn=(e,t,r,n)=>{const[,o]=Sn(e,t,r,n,[]);return o},Sn=(e,t,r,n,o)=>{return t(e,n,o)?r(n,e,o):Array.isArray(e)?Un(e,t,r,n,o):"object"==typeof(i=e)&&null!=i?Nn(e,t,r,n,o):[n,e];var i},Nn=(e,t,r,n,o)=>{let i=n;const s={};for(const[a,c]of Object.entries(e)){const[e,n]=Sn(c,t,r,i,[...o,a]);s[a]=n,i=e}return[i,s]},Un=(e,t,r,n,o)=>{const i=[];let s=n;for(const[a,c]of e.entries()){const[e,n]=Sn(c,t,r,s,[...o,a]);i[a]=n,s=e}return[s,i]};class Rn{constructor({token:e,endpoint:t=new URL("https://api.nft.storage")}){this.token=e,this.endpoint=t}static auth(e){if(!e)throw new Error("missing token");return{Authorization:`Bearer ${e}`}}static async storeBlob({endpoint:e,token:t},r){const n=new URL("/upload",e);if(0===r.size)throw new Error("Content size is 0, make sure to provide some content");const o=await yn(n.toString(),{method:"POST",headers:Rn.auth(t),body:r}),i=await o.json();if(i.ok)return i.value.cid;throw new Error(i.error.message)}static async storeCar({endpoint:e,token:t},r,{onStoredChunk:n}={}){const o=10485760,i=r instanceof bn?await wn.fromBlob(r,o):new wn(r,o),s=H(3,(async function(r){const o=[];for await(const e of r)o.push(e);const i=new bn(o,{type:"application/car"}),s=await Z((()=>Rn.storeBlob({endpoint:e,token:t},i)),{retries:5});return n&&n(i.size),s}));let a;for await(const c of s(i.cars()))a=c;return a}static async storeDirectory({endpoint:e,token:t},r){const n=new URL("/upload",e),o=new gn;let i=0;for(const c of r)o.append("file",c,c.name),i+=c.size;if(0===i)throw new Error("Total size of files should exceed 0, make sure to provide some content");const s=await yn(n.toString(),{method:"POST",headers:Rn.auth(t),body:o}),a=await s.json();if(a.ok)return a.value.cid;throw new Error(a.error.message)}static async store({endpoint:e,token:t},r){jn(r);const n=new URL("/store",e),o=(e=>{const[t,r]=Sn(e,_n,In,new gn,[]);return t.set("meta",JSON.stringify(r)),t})(r),i=new Set(o.keys()),s=await yn(n.toString(),{method:"POST",headers:Rn.auth(t),body:o}),a=await s.json();if(!0===a.ok){const{value:e}=a;return(({ipnft:e,url:t,data:r},n)=>new kn(e,t,Dn(r,xn,Cn,n)))(e,i)}throw new Error(a.error.message)}static async status({endpoint:e,token:t},r){const n=new URL(`/${r}`,e),o=await yn(n.toString(),{method:"GET",headers:Rn.auth(t)}),i=await o.json();if(i.ok)return{cid:i.value.cid,deals:On(i.value.deals),size:i.value.size,pin:Ln(i.value.pin),created:new Date(i.value.created)};throw new Error(i.error.message)}static async check({endpoint:e},t){const r=new URL(`/check/${t}`,e),n=await yn(r.toString()),o=await n.json();if(o.ok)return{cid:o.value.cid,deals:On(o.value.deals),pin:o.value.pin};throw new Error(o.error.message)}static async delete({endpoint:e,token:t},r){const n=new URL(`/${r}`,e),o=await yn(n.toString(),{method:"DELETE",headers:Rn.auth(t)}),i=await o.json();if(!i.ok)throw new Error(i.error.message)}storeBlob(e){return Rn.storeBlob(this,e)}storeCar(e,t){return Rn.storeCar(this,e,t)}storeDirectory(e){return Rn.storeDirectory(this,e)}status(e){return Rn.status(this,e)}delete(e){return Rn.delete(this,e)}check(e){return Rn.check(this,e)}store(e){return Rn.store(this,e)}}const jn=({name:e,description:t,image:r,decimals:n})=>{if("string"!=typeof e)throw new TypeError("string property `name` identifying the asset is required");if("string"!=typeof t)throw new TypeError("string property `description` describing asset is required");if(!(r instanceof bn))throw new TypeError("property `image` must be a Blob or File object");if(r.type.startsWith("image/")||console.warn("According to ERC721 Metadata JSON Schema 'image' must have 'image/*' mime type.\n\nFor better interoperability we would highly recommend storing content with different mime type under 'properties' namespace e.g. `properties: { video: file }` and using 'image' field for storing a preview image for it instead.\n\nFor more context please see ERC-721 specification https://eips.ethereum.org/EIPS/eip-721"),void 0!==n&&"number"!=typeof n)throw new TypeError("property `decimals` must be an integer value")},On=e=>e.map((e=>{const{dealActivation:t,dealExpiration:r,lastChanged:n}={dealExpiration:null,dealActivation:null,...e};return{...e,lastChanged:new Date(n),...t&&{dealActivation:new Date(t)},...r&&{dealExpiration:new Date(r)}}})),Ln=e=>({...e,created:new Date(e.created)});export{mn as F,Rn as N,R as a,I as b,h as c,N as d,d as e,p as f,j as i,D as r,U as s,S as t};
